import groovy.transform.Field;

@Library('shared-libs')

def printInfo() {
  def items = [
  ghprbActualCommit,
  ghprbActualCommitAuthor,
  ghprbActualCommitAuthorEmail,
  ghprbPullDescription,
  ghprbPullId,
  ghprbPullLink,
  ghprbPullTitle,
  ghprbSourceBranch,
  ghprbTargetBranch,
  ghprbCommentBody,
  sha1
  ]
  items.each { item ->
  println item
  }
}

pipeline {
  agent none
  stages {
    stage('testing') {
    agent { label 'master' }
      steps {
        script {
          try {
            withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'TOKEN')]) {
              printInfo() 
              def githubIssue = new GithubIssue()
              githubIssue.setBody("testing things")
              githubIssue.setTitle("Issue Title: ${ghprbSourceBranch}")
              githubIssue.setAuthor(ghprbActualCommitAuthor)
              githubIssue.setToken(TOKEN)
              githubIssue.setOrgName('stephencshelton')
              githubIssue.setRepoName('pipeline-libs')
              githubIssue.createIssue()
          }
          catch (err) {
            println 'something broke'
          }
        }
      }
    }
    stage('notification') {
      agent { label 'master' }
      steps {
        echo "notification"
      }
    }
  }
}
